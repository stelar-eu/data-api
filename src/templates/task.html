<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>STELAR | Task Overview</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css">    
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="{{ url_for('static', filename='images.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='stelar.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favico.png') }}" type="image/png">
  </head>
  <body >
    <div class="page">
      {%  include 'header.html' %}
      <div class="page-wrapper">
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <div class="page-pretitle">
                            {{ task_id }}
                        </div>
                        <h2 class="page-title">
                            Task Overview
                        </h2>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-body">
            <div class="container-xl">
                <div class="row row-cards">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Basic Information</div>
                                <div class="mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><path d="M3 6l0 13" /><path d="M12 6l0 13" /><path d="M21 6l0 13" /></svg>
                                    Owner Workflow: <strong><a href="/stelar/console/v1/workflows/{{ task_metadata['metadata']['workflow_exec_id'] }}" target="_blank" >{{ task_metadata['metadata']['workflow_exec_id'] }}</a></strong>
                                </div>
                                <div class="mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-2 text-secondary icon-tabler icons-tabler-outline icon-tabler-e-passport"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 5m0 2a2 2 0 0 1 2 -2h16a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-16a2 2 0 0 1 -2 -2z" /><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M9 12h-7" /><path d="M15 12h7" /></svg>                                        
                                    Task ID: <strong>{{ task_metadata['metadata']['task_exec_id'] }}</strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon me-2 text-secondary icon-tabler icons-tabler-outline icon-tabler-tool"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10h3v-3l-3.5 -3.5a6 6 0 0 1 8 8l6 6a2 2 0 0 1 -3 3l-6 -6a6 6 0 0 1 -8 -8l3.5 3.5" /></svg>
                                    Tool: <strong>{{ task_metadata['metadata']['tags'].get('tool_image', 'Image Name Not Available')}}</strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon me-2 text-secondary icon-tabler icons-tabler-outline icon-tabler-player-play"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 4v16l13 -8z" /></svg>                                        
                                    Started at: <strong>{{ task_metadata['metadata'].get('start_date', 'Not available') | replace("T", " ") }}</strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon me-2 text-secondary icon-tabler icons-tabler-outline icon-tabler-hand-stop"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 13v-7.5a1.5 1.5 0 0 1 3 0v6.5" /><path d="M11 5.5v-2a1.5 1.5 0 1 1 3 0v8.5" /><path d="M14 5.5a1.5 1.5 0 0 1 3 0v6.5" /><path d="M17 7.5a1.5 1.5 0 0 1 3 0v8.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7a69.74 69.74 0 0 1 -.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47" /></svg>                                 
                                    Finished at: <strong>{{ task_metadata['metadata'].get('end_date', 'Not finished') | replace("T", " ")  }}</strong>
                                </div>
                                <div>
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon me-2 text-secondary icon-tabler icons-tabler-outline icon-tabler-brand-redux"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.54 7c-.805 -2.365 -2.536 -4 -4.54 -4c-2.774 0 -5.023 2.632 -5.023 6.496c0 1.956 1.582 4.727 2.512 6" /><path d="M4.711 11.979c-1.656 1.877 -2.214 4.185 -1.211 5.911c1.387 2.39 5.138 2.831 8.501 .9c1.703 -.979 2.875 -3.362 3.516 -4.798" /><path d="M15.014 19.99c2.511 0 4.523 -.438 5.487 -2.1c1.387 -2.39 -.215 -5.893 -3.579 -7.824c-1.702 -.979 -4.357 -1.235 -5.927 -1.07" /><path d="M10.493 9.862c.48 .276 1.095 .112 1.372 -.366a1 1 0 0 0 -.367 -1.365a1.007 1.007 0 0 0 -1.373 .366a1 1 0 0 0 .368 1.365z" /><path d="M9.5 15.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M15.5 14m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>                                        
                                    Task state: <span id="task-state-badge-{{ task_metadata['metadata']['task_exec_id'] }}" class="badge me-1 {% if task_metadata['metadata']['state'] == 'succeeded' %}bg-green{% elif task_metadata['metadata']['state'] == 'failed' %}bg-danger{% else %}bg-warning{% endif %}"></span>
                                    <span id="task-state-text-{{ task_metadata['metadata']['task_exec_id'] }}">{{ task_metadata['metadata']['state'] | capitalize }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Execution Parameters & Information</div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-brand-metabrainz"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7v10l7 4v-18z" /><path d="M21 7v10l-7 4v-18z" /></svg>
                                    MinIO API Endpoint: <strong>{{ task_input['minio']['endpoint_url'] }}</strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-brand-docker"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 12.54c-1.804 -.345 -2.701 -1.08 -3.523 -2.94c-.487 .696 -1.102 1.568 -.92 2.4c.028 .238 -.32 1 -.557 1h-14c0 5.208 3.164 7 6.196 7c4.124 .022 7.828 -1.376 9.854 -5c1.146 -.101 2.296 -1.505 2.95 -2.46z" /><path d="M5 10h3v3h-3z" /><path d="M8 10h3v3h-3z" /><path d="M11 10h3v3h-3z" /><path d="M8 7h3v3h-3z" /><path d="M11 7h3v3h-3z" /><path d="M11 4h3v3h-3z" /><path d="M4.571 18c1.5 0 2.047 -.074 2.958 -.78" /><path d="M10 16l0 .01" /></svg>
                                    Tool Image: <strong>{{ task_metadata['metadata']['tags'].get('tool_image', 'Image Name Not Available')}}</strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-file-import"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M5 13v-8a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-5.5m-9.5 -2h7m-3 -3l3 3l-3 3" /></svg>
                                    Inputs: <strong><a href="#" data-bs-toggle="modal" data-bs-target="#inputs-json-modal">View Input Resources</a></strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="1.25"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-file-arrow-right"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15h6" /><path d="M12.5 17.5l2.5 -2.5l-2.5 -2.5" /></svg>
                                    Output: <strong><a href="#" data-bs-toggle="modal" data-bs-target="#outputs-json-modal">View Output Resources</a></strong>
                                </div>
                                <div class="mb-2">
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-chart-arcs-3"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M7 12a5 5 0 1 0 5 -5" /><path d="M6.29 18.957a9 9 0 1 0 5.71 -15.957" /></svg>
                                    Metrics: <strong><a href="#" data-bs-toggle="modal" data-bs-target="#metrics-json-modal">View Metrics in JSON</a></strong>
                                </div>
                                <div>
                                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 text-secondary icon icon-tabler icons-tabler-outline icon-tabler-message"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 9h8" /><path d="M8 13h6" /><path d="M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z" /></svg>
                                    Tool Messages: <strong><a href="#" data-bs-toggle="modal" data-bs-target="#messages-modal">View Tool Messages</a></strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <h3 class="card-title">Task In-Cluster Jobs</h3>
                                    <div class="text-secondary">
                                        <small>
                                            Jobs and logs are only available for tools executed within the KLMS cluster. Logs are available for 24h after a job is executed.
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive overflow-hidden">
                                <table class="table table-vcenter card-table" id="job-table">
                                    <thead>
                                        <tr>
                                            <th>Task Job ID</th>
                                            <th>Created at</th>
                                            <th>Status</th>
                                            <th class="w-1"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="accordion" id="task-list">
                                        {% for task_id, task_data in logs.items() %}
                                            <tr id="task-{{ task_id }}" data-bs-toggle="collapse" class="cursor-pointer" data-bs-target="#collapse-{{ task_id }}">
                                                <td>{{ task_id }}</td>
                                                <td id="task-{{ task_id }}-date" class="text-secondary"></td>
                                                <td class="text-secondary">
                                                    <span id="task-{{ task_id }}-badge"  class="badge {% if task_data['status'] == 'Succeeded' %}bg-success{% elif task_data['status'] =='Running' %}bg-warning{% else %}bg-danger{% endif %} me-1"></span>
                                                    <p id="task-{{ task_id }}-status" class="d-inline m-1">{{ task_data['status'] }}</p>
                                                </td>
                                                <td>
                                                    <button class="btn btn-link p-0 accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ task_id }}" aria-expanded="false" aria-controls="collapse-{{ loop.index }}"></button>
                                                </td>
                                            </tr>
                                            <tr id="collapse-{{ task_id }}" class="accordion-collapse collapse">
                                                <td colspan="5">
                                                    <div class="accordion-body">
                                                        <h4>Runtime Logs</h4>
                                                        <div style="max-height: 40rem; overflow: auto;">
                                                            <pre id="task-{{ task_id }}-logs" style="max-height: 100%; overflow: auto; white-space: pre-wrap; word-break: break-all;">{{ task_data['logs'] | replace('\n', '<br>') | replace('\"', '') | safe }}</pre>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
            <div class="modal modal-blur fade" id="inputs-json-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Task Input Resources</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-sm table-borderless">
                                <thead>
                                <tr>
                                    <th>Resource ID</th>
                                    <th class="text-end">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for item in task_input['input'] %}
                                <tr>
                                    <td>
                                        <div>{{ item }}</div>
                                    </td>
                                    <td class="w-1 fw-bold text-end">
                                        <a href="/s3/browser/{{ item | replace('s3://', '') }}" target="_blank">Go to</a>
                                    </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal modal-blur fade" id="outputs-json-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Task Output Resources</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-sm table-borderless">
                                <thead>
                                <tr>
                                    <th>Resource ID</th>
                                    <th class="text-end">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% if task_metadata['output'] %}
                                    {% for item in task_metadata['output'] %}
                                    <tr>
                                        <td>
                                            <div>{{ item }}</div>
                                        </td>
                                        <td class="w-1 fw-bold text-end">
                                            <a href="/stelar/console/v1/resource/{{ item }}" target="_blank">View</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% endif %}
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal modal-blur fade" id="metrics-json-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Task Metrics</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>                        
                            <div class="modal-body">
                                <table class="table table-sm table-borderless">
                                    <thead>
                                    <tr>
                                        <th>Metrics Key</th>
                                        <th class="text-end">Value</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        {% if task_metadata['metrics'] %}
                                            {% for key, value in task_metadata['metrics'].items() %}
                                            <tr>
                                                <td>
                                                    <div>{{ key }}</div>
                                                </td>
                                                <td class="w-3 fw-bold text-end">
                                                    {{ value }}
                                                </td>
                                            </tr>
                                            {% endfor %}                                
                                        {% else %}
                                            <tr>
                                                <td colspan="2">No Metrics Available</td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        <div class="modal-footer">
                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal modal-blur fade" id="messages-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Tool Messages</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body"><p>{{ task_metadata['metadata']['tags'].get('log','No Messages Available') }}</p></div>
                        <div class="modal-footer">
                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {%  include 'footer.html' %}
        </div>
    </div>
  </body>
  <script>

        function fetchTaskData() {
            $.ajax({
                url: '/stelar/api/v1/task/runtime/read?id={{task_id}}', 
                method: 'GET',  
                success: function(response) {
                    updateTaskTable(response);
                },
                error: function() {
                    console.error("Error fetching task data.");
                }
            });
        }

        function updateTaskTable(data) {
            for (const task_id in data) {
                const preElement = $(`#task-${task_id}-logs`);
                const statusTextElement = $(`#task-${task_id}-status`);
                const statusBadgeElement = $(`#task-${task_id}-badge`);
                
                if (preElement.length > 0) {
                    // Task already exists, update its status and logs
                    // Update the status badge
                    statusBadgeElement
                        .removeClass('bg-success bg-warning bg-danger')
                        .addClass(
                            data[task_id].status === 'Succeeded' 
                                ? 'bg-success' 
                                : data[task_id].status === 'Running' 
                                ? 'bg-warning' 
                                : 'bg-danger'
                        );

                    // Update the status text
                    statusTextElement.text(data[task_id].status);
                    
                    // Update the logs in the <pre> element
                    preElement.html(data[task_id].logs.replace(/\n/g, '<br>').replace(/\"/g, ''));
                } else {
                    // If the task row doesn't exist, create a new one
                    const newRow = `
                        <tr id="task-${task_id}" data-bs-toggle="collapse" class="cursor-pointer" data-bs-target="#collapse-${task_id}">
                            <td>${task_id}</td>
                            <td class="text-secondary">${data[task_id].created_at}</td>
                            <td class="text-secondary">
                                <span id="task-${task_id}-badge" class="badge ${
                                    data[task_id].status === 'Succeeded' 
                                        ? 'bg-success' 
                                        : data[task_id].status === 'Running' 
                                        ? 'bg-warning' 
                                        : 'bg-danger'
                                } me-1"></span>
                                <p id="task-${task_id}-status" class="d-inline m-1">${data[task_id].status}</p>
                            </td>
                            <td>
                                <button class="btn btn-link p-0 accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${task_id}" aria-expanded="false" aria-controls="collapse-${task_id}"></button>
                            </td>
                        </tr>
                        <tr id="collapse-${task_id}" class="accordion-collapse collapse">
                            <td colspan="5">
                                <div class="accordion-body">
                                    <h4>Runtime Logs</h4>
                                    <div style="max-height: 40rem; overflow: auto;">
                                        <pre id="task-${task_id}-logs" style="max-height: 100%; overflow-x: auto; overflow-y: auto; white-space: pre;">${data[task_id].logs.replace(/\n/g, '<br>').replace(/\"/g, '')}</pre>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                    $('#task-list').append(newRow);
                }
            }
        }


        setInterval(fetchTaskData, 8000);

        // Initial fetch when the page loads
        $(document).ready(function() {
            fetchTaskData();
        });
   </script>
  

    <script>
        function loadTaskMetadata(id) {
            $.ajax({
                url: '/stelar/api/v1/task/execution/read?id={{task_id}}',
                data: { id: id },
                method: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Update Output Resources Modal
                        updateOutputModal(response.result.output);

                        // Update Metrics Modal
                        updateMetricsModal(response.result.metrics);

                        // Update Logs Modal
                        updateLogsModal(response.result.metadata.tags.log);

                        // Update the task state
                        updateTaskState(response.result.metadata.state);
                    } else {
                        alert("Failed to fetch task data");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", status, error);
                    alert("Error fetching task data.");
                }
            });
        }

        function updateOutputModal(output) {
            const outputModalBody = $('#outputs-json-modal .modal-body tbody');
            outputModalBody.empty();
            if(output){
                if (output.length > 0) {
                    output.forEach(item => {
                        const row = `<tr>
                                        <td><div>${item}</div></td>
                                        <td class="w-1 fw-bold text-end">
                                            <a href="/stelar/console/v1/resource/${item}" target="_blank">View</a>
                                        </td>
                                    </tr>`;
                        outputModalBody.append(row);
                    });
                } else {
                    outputModalBody.append('<tr><td colspan="2">No Output Resources Available</td></tr>');
                }
            }else{
                outputModalBody.append('<tr><td colspan="2">No Output Resources Available</td></tr>');
            }
        }

        function updateMetricsModal(metrics) {
            const metricsModalBody = $('#metrics-json-modal .modal-body tbody');
            metricsModalBody.empty(); 

            if (metrics) {
                Object.keys(metrics).forEach(key => {
                    const row = `<tr>
                                    <td><div>${key}</div></td>
                                    <td class="w-3 fw-bold text-end">${metrics[key]}</td>
                                </tr>`;
                    metricsModalBody.append(row);
                });
            } else {
                metricsModalBody.append('<tr><td colspan="2">No Metrics Available</td></tr>');
            }
        }

        function updateLogsModal(log) {
            const logsModalBody = $('#messages-modal .modal-body p');
            if (log) {
                logsModalBody.text(log);
            } else {
                logsModalBody.text('Messages Not Produced');
            }
        }

        function updateTaskState(newState) {
            const taskStateBadgeId = `task-state-badge-{{task_id}}`;
            const taskStateTextId = `task-state-text-{{task_id}}`;

            const taskStateBadge = document.getElementById(taskStateBadgeId);
            if (taskStateBadge) {
                if (newState === 'succeeded') {
                    taskStateBadge.className = 'badge me-1 bg-green';
                } else if (newState === 'failed') {
                    taskStateBadge.className = 'badge me-1 bg-danger';
                } else {
                    taskStateBadge.className = 'badge me-1 bg-warning';
                }
            }

            const taskStateText = document.getElementById(taskStateTextId);
            if (taskStateText) {
                taskStateText.textContent = newState.charAt(0).toUpperCase() + newState.slice(1);
            }
        }


        $(document).ready(function() {
            const taskId = '89617a4b-5ceb-4749-b412-77fcf0dc38b7'; // example task ID
        });

        setInterval(loadTaskMetadata, 8000);

        $(document).ready(function() {
            loadTaskMetadata();
        });
    </script>

</html>
