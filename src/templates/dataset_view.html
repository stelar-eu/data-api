<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>STELAR | Manage Dataset </title>
    <!-- CSS files -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css">    
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='stelar.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favico.png') }}" type="image/png">
  </head>
  <body >
    <div class="page">
      <!-- Navbar -->
      {%  include 'header.html' %}
      <div class="page-wrapper">
        <!-- Page header -->
         <!-- Page header -->
        <div class="page-header d-print-none">
            <div class="container-xl">
              <div class="row g-2 align-items-center">
                <div class="col">
                  <!-- Page pre-title -->
                  <div class="page-pretitle">
                    {{ dataset.get('id') }}
                  </div>
                  <h2 class="page-title">
                    {{ dataset.get('title') }}
                  </h2>
                </div>
              </div>
            </div>
          </div>
        <!-- Page body -->
        <div class="page-body">
          <div class="container-xl">
            <div class="row g-4">
              <div class="col-md-4">
                    <div class="card">
                      <div class="card-body">
                        <div class="card-title">Basic info</div>
                        <div class="mb-2"> <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" /><path d="M3 6l0 13" /><path d="M12 6l0 13" /><path d="M21 6l0 13" /></svg>
                            Title: <strong>{{ dataset.get('title') }}</strong>
                        </div>
                        <div class="mb-2">
                          <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="text-secondary me-2 icon icon-tabler icons-tabler-outline icon-tabler-e-passport"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 5m0 2a2 2 0 0 1 2 -2h16a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-16a2 2 0 0 1 -2 -2z" /><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M9 12h-7" /><path d="M15 12h7" /></svg>
                            ID: <strong>{{ dataset.get('id') }}</strong>
                          </div>
                        <div class="mb-2">
                          <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="text-secondary me-2 icon icon-tabler icons-tabler-outline icon-tabler-user"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /></svg>                            Creator: <strong>{{ dataset.get('author') }}</strong>
                          </div>
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M3 21l18 0" />
                            <path d="M3 10l18 0" />
                            <path d="M5 6l7 -3l7 3" />
                            <path d="M4 10l0 11" />
                            <path d="M20 10l0 11" />
                            <path d="M8 14l0 3" />
                            <path d="M12 14l0 3" />
                            <path d="M16 14l0 3" />
                            </svg>        
                            Owner Organization: <strong>{{ dataset.get('organization') }}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" />
                                <path d="M16 3v4" />
                                <path d="M8 3v4" />
                                <path d="M4 11h16" />
                                <path d="M7 14h.013" />
                                <path d="M10.01 14h.005" />
                                <path d="M13.01 14h.005" />
                                <path d="M16.015 14h.005" />
                                <path d="M13.015 17h.005" />
                                <path d="M7.01 17h.005" />
                                <path d="M10.01 17h.005" />
                                </svg>
                            Date Created: <strong>{{ dataset.get('metadata_created') | datetimeformat }}</strong>
                          </div>
                          <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" />
                                <path d="M16 3v4" />
                                <path d="M8 3v4" />
                                <path d="M4 11h16" />
                                <path d="M7 14h.013" />
                                <path d="M10.01 14h.005" />
                                <path d="M13.01 14h.005" />
                                <path d="M16.015 14h.005" />
                                <path d="M13.015 17h.005" />
                                <path d="M7.01 17h.005" />
                                <path d="M10.01 17h.005" />
                                </svg>
                            Date Modified: <strong>{{ dataset.get('metadata_modified') | datetimeformat }}</strong>
                          </div>
                          <div class="mb-2">

                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-secondary" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                <path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                            </svg>
                            Visibility: <strong>
                                {% if dataset.get('private') %}
                                    Private
                                {% else %}
                                    Public
                                {% endif %}
                            </strong>
                          </div>
                      </div>
                    </div>
                    <div class="card mt-2">
                      <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                          <h5 class="card-title mb-0">Tags</h5>
                          <a href="#" class="" title="Edit Tags" data-bs-toggle="tooltip" data-bs-placement="bottom">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2 icon icon-tabler icons-tabler-outline icon-tabler-pencil"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                          </a>
                      </div>
                        <div class="mb-2">
                            {% for tag in dataset.get('tags') %}
                                <span class="tag m-1 mb-0">{{ tag.get('display_name') }}
                                </span>
                            {% endfor %}
                        </div>
                      </div>
                    </div>
                    <div class="card mt-2">
                      <div class="card-body">
                        <div class="card-title">Dataset Description</div>
                        <div class="mb-2">
                          <div class="markdown">
                              <p>
                                {{ dataset.get('notes') }}
                              </p>
                          </div>
                        </div>
                      </div>
                    </div>
              </div>
              <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title">Package Resources</div>
                            <div class="col-auto mb-3 d-flex justify-content-end">
                                <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-new-resource">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                  New Resource
                                </a>
                            </div>
                            <div class="table-responsive">
                                <table  class="table table-vcenter card-table">
                                <thead>
                                    <tr>
                                    <th style="width: 15%;">Relation</th>
                                    <th style="width: 40%;">Resource Name</th>
                                    <th style="width: 40%;">Path</th>
                                    <th style="width: 10%">Format</th>
                                    <th class="w-1"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for resource in dataset.get('resources') %}
                                    <tr>
                                        <td class="text-sm">
                                          {% if resource.get('relation') == 'owned' %}
                                          <span class="badge bg-blue text-blue-fg">OWNED</span>
                                          {% elif resource.get('relation') == 'profile' %}
                                          <span class="badge bg-orange text-orange-fg">PROFILE</span>
                                          {% else %}
                                          <span class="badge bg-secondary text-secondary-fg">NONE</span>
                                          {% endif %}
                                        </td>
                                        <td class="text-sm">{{ resource['name'] }}</td>
                                        <td class="text-sm"><small>{{ resource['url'] | replace('https://minio.stelar.gr', '') }}</small></td>
                                        <td class="text-sm">{{ resource['format'] }}</td>
                                        <td>
                                          <div class="dropdown">
                                            <button class="btn btn-sm d-flex p-2 text-reset" data-bs-toggle="dropdown" aria-label="Open Resource Menu">
                                              Manage
                                              <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"  class="ms-1 icon icon-tabler icons-tabler-filled icon-tabler-caret-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 9c.852 0 1.297 .986 .783 1.623l-.076 .084l-6 6a1 1 0 0 1 -1.32 .083l-.094 -.083l-6 -6l-.083 -.094l-.054 -.077l-.054 -.096l-.017 -.036l-.027 -.067l-.032 -.108l-.01 -.053l-.01 -.06l-.004 -.057v-.118l.005 -.058l.009 -.06l.01 -.052l.032 -.108l.027 -.067l.07 -.132l.065 -.09l.073 -.081l.094 -.083l.077 -.054l.096 -.054l.036 -.017l.067 -.027l.108 -.032l.053 -.01l.06 -.01l.057 -.004l12.059 -.002z" /></svg>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow view-resource-btn">
                                                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-view-id" data-resource-id="{{ resource['id'] }}">
                                                  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
                                                  View</a>
                                                <div class="dropdown-divider"></div>
                                                <a edit-resource-id="{{ resource['id'] }}" class="dropdown-item edit-resource-btn">
                                                  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 icon icon-tabler icons-tabler-outline icon-tabler-pencil"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                                  Edit</a>
                                                <a  del-resource-id="{{ resource['id'] }}" class="dropdown-item del-resource-btn">
                                                  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="me-2 icon icon-tabler icons-tabler-outline icon-tabler-trash"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>
                                                  Delete</a>
                                            </div>
                                          </div>
                                        </td>
                                    </tr>                                    
                                    {% endfor %}
                                </tbody>
                                </table>
                                <p class="text-secondary text-sm mt-2 text-center">In order to use the above resources to tool executions please use the <strong>Resource ID</strong> as input.</p>
                            </div>
                        </div>
                    </div>                
              </div>
            </div>
            <div class="modal modal-blur fade" id="modal-new-resource" tabindex="-1" role="dialog" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">New Resource</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <label class="form-label">Name</label>
                      <input type="text" class="form-control" name="example-text-input" placeholder="Resource Name">
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Description</label>
                      <input type="text" class="form-control" name="resource-description" placeholder="Resource Description">
                    </div>
                    <label class="form-label">Resource Type</label>
                    <div class="form-selectgroup-boxes row mb-3">
                      <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                          <input type="radio" name="resource-type" value="external" class="form-selectgroup-input" disabled>
                          <span class="form-selectgroup-label d-flex align-items-center p-3">
                            <span class="me-3">
                              <span class="form-selectgroup-check"></span>
                            </span>
                            <span class="form-selectgroup-label-content">
                              <span class="form-selectgroup-title strong mb-1">External Resource</span>
                              <span class="d-block text-secondary">Provide only an external URL to resource. No uploads.</span>
                            </span>
                          </span>
                        </label>
                      </div>
                      <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                          <input type="radio" name="resource-type" value="internal" class="form-selectgroup-input" checked>
                          <span class="form-selectgroup-label d-flex align-items-center p-3">
                            <span class="me-3">
                              <span class="form-selectgroup-check"></span>
                            </span>
                            <span class="form-selectgroup-label-content">
                              <span class="form-selectgroup-title strong mb-1">Upload Resource</span>
                              <span class="d-block text-secondary">Upload a file to MinIO that will map as path of the resource.</span>
                            </span>
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="modal-body" id="externalResource">
                    <form id="externalResourceForm" enctype="multipart/form-data">
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="mb-3">
                          <label class="form-label">URL</label>
                          <input type="text" class="form-control">
                        </div>
                      </div>
                      <div class="col-lg-12">
                        <div class="mb-3">
                          <label class="form-label">Format</label>
                            <div class="form-selectgroup">
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="formatType" value="JSON" class="form-selectgroup-input" checked>
                                <span class="form-selectgroup-label">JSON</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="formatType" value="CSV" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">CSV</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="formatType" value="TXT" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">TXT</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="formatType" value="PDF" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">PDF</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="formatType" value="HTML" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">HTML</span>
                              </label>
                            </div>
                        </div>
                      </div>
                    </form>
                    </div>
                  </div>
                  <div class="modal-body" id="internalResource" style="display:none;">
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="mb-3">
                        <form id="uploadForm" enctype="multipart/form-data">
                          <div class="form-label">Select Origin File</div>
                          <input type="file" class="form-control" id="fileInput" required />
                        </div>
                      </div>
                      <div class="col-lg-12">
                        <div class="mb-3">
                          <label class="form-label">Destination Path</label>
                          <select class="form-select" id="pathSelector" required></select>
                        </div>
                      </div>
                      <div class="col-lg-12">
                        <div class="mb-3">
                          <label class="form-label">Format</label>
                            <div class="form-selectgroup">
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="name" value="JSON" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">JSON</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="name" value="CSV" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">CSV</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="name" value="TXT" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">TXT</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="name" value="PDF" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">PDF</span>
                              </label>
                              <label class="form-selectgroup-item">
                                <input type="checkbox" name="name" value="HTML" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">HTML</span>
                              </label>
                            </div>
                        </div>
                      </div>
                    </form>
                    <div class="col-lg-12">
                      <div class="progress" id="progress-bar-container" style="flex-grow: 1; margin-right: 20px;">
                        <div class="progress-bar" id="progress-bar" style="width: 0%" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="0% Complete">
                          <span id="progress-text">0%</span>
                        </div>
                      </div>
                    </div>
                    <!-- Upload status -->
                    <div id="uploadStatus" class="col-lg-12"></div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
                      Cancel
                    </a>
                    <a href="#" class="btn btn-primary ms-auto" id="submitResource">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                      Publish New Resource
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal modal-blur fade" id="modal-view-id" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Resource ID</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label class="form-label">Copy this ID and use it to tool executions as input</label>
                            <input type="text" class="form-control" id="resource-id-input" name="example-disabled-input" placeholder="Resource-ID" readonly>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="copyText()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
                                    <path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
                                  </svg>
                                Copy ID</button>
                        </div>
                    </div>
                </div>
            </div>
          </div>
        </div>
        {% include 'footer.html'%}
      </div>
    </div>
    <script>
        // When a "View ID" button is clicked
        function attachViewIdEventListeners() {
            const viewButtons = document.querySelectorAll('.view-resource-btn');
            viewButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const resourceId = this.getAttribute('data-resource-id');
                    const inputField = document.getElementById('resource-id-input');
                    inputField.value = resourceId;
                });
            });
        }
        document.addEventListener('DOMContentLoaded', attachViewIdEventListeners);
        
        function copyText() {
            const inputField = document.getElementById('resource-id-input');
            navigator.clipboard.writeText(inputField.value);
        }
        </script>
        


        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const externalResourceForm = document.getElementById('externalResourceForm');
            const internalResourceForm = document.getElementById('uploadForm');
            const externalResource = document.getElementById('externalResource');
            const internalResource = document.getElementById('internalResource');
            const submitButton = document.getElementById('submitResource');
            const resourceRadios = document.querySelectorAll('input[name="resource-type"]');
            
            // Reset modal on close
            $('#resourceModal').on('hidden.bs.modal', function () {
              resetModalForms();
            });

            // Function to reset the forms and progress bar when modal closes
            function resetModalForms() {
              // Reset forms
              externalResourceForm.reset();
              internalResourceForm.reset();

              // Hide progress bar and reset its state
              $('#progress-bar-container').hide();
              $('#progress-bar').width('0%');
              $('#progress-text').text('0%');

              // Clear upload status message
              $('#uploadStatus').html('');

              // Optionally reset radio button selection to the default (if needed)
              document.querySelector('input[name="resource-type"][value="external"]').checked = true;
              toggleResourceForm(); // Re-initialize form visibility
            }


            // Function to toggle visibility of forms based on selected radio button
            function toggleResourceForm() {
              if (document.querySelector('input[name="resource-type"]:checked').value === 'external') {
                externalResource.style.display = 'block';
                internalResource.style.display = 'none';
              } else {
                externalResource.style.display = 'none';
                internalResource.style.display = 'block';
              }
            }

            // Attach event listeners to radio buttons
            resourceRadios.forEach(radio => {
              radio.addEventListener('change', toggleResourceForm);
            });

            // Initialize form visibility based on current selection
            toggleResourceForm();

            // Handle form submission
            submitButton.addEventListener('click', function() {
              const selectedResourceType = document.querySelector('input[name="resource-type"]:checked').value;

              if (selectedResourceType === 'external') {
                // Serialize the external form data
                const formData = new FormData(externalResourceForm);
                handleExternalResourceSubmit(formData);  // Trigger external resource AJAX

              } else if (selectedResourceType === 'internal') {
                // Serialize the internal form data
                const formData = new FormData(internalResourceForm);
                handleInternalResourceSubmit(formData);  // Trigger internal resource AJAX
              }
            });

            // Function to handle external resource submission (AJAX)
            function handleExternalResourceSubmit(formData) {
              fetch('/submit-external-resource', {
                method: 'POST',
                body: formData
              })
              .then(response => response.json())
              .then(data => {
                console.log('External resource submitted successfully:', data);
                alert('External resource submitted successfully!');
              })
              .catch(error => {
                console.error('Error submitting external resource:', error);
              });
            }

            // Function to handle internal resource submission with progress bar (AJAX)
            function handleInternalResourceSubmit() {
              const formData = new FormData();

              const selectedOption = $('#pathSelector').find(':selected');  // Find the selected option
              const bucketName = selectedOption.closest('optgroup').attr('label');  // Get bucket name from optgroup label
              const filePath = selectedOption.val();  // Get full path (bucket/folder) from option value
              
              formData.append('file', $('#fileInput')[0].files[0]);
              formData.append('bucket', bucketName);
              formData.append('path', filePath);

              // Show the progress bar when uploading begins
              $('#progress-bar-container').show();
              $('#progress-bar').width('0%'); // Reset the progress bar width
              $('#progress-text').text('0%');

              $.ajax({
                  url: '/stelar/console/v1/publisher/upload_file',  // Change to your actual server-side file upload URL
                  method: 'POST',
                  data: formData,
                  contentType: false,
                  processData: false,
                  xhr: function() {
                      var xhr = new window.XMLHttpRequest();
                      xhr.upload.addEventListener('progress', function(event) {
                          if (event.lengthComputable) {
                              var percentComplete = (event.loaded / event.total) * 100;
                              $('#progress-bar').width(percentComplete + '%');
                              $('#progress-text').text(Math.round(percentComplete) + '%');
                          }
                      }, false);
                      return xhr;
                  },
                  success: function(response) {
                      $('#uploadStatus').html('<div class="alert alert-success">File uploaded successfully!</div>');
                      $('#progress-bar').width('0%'); // Reset progress bar
                      $('#progress-text').text('0%');
                      $('#progress-bar-container').hide(); // Hide the progress bar after success

                      // Call the second AJAX function to link the resource
                      linkResourceAfterUpload(bucketName+"/"+filePath);  // Send metadata after success
                  },
                  error: function(error) {
                      $('#uploadStatus').html('<div class="alert alert-danger">File upload failed!</div>');
                      $('#progress-bar-container').hide(); // Hide the progress bar after failure
                  }
              });
            }

            function linkResourceAfterUpload(filePath) {
              const description = $('input[name="resource-description"]').val();
              const name = $('input[name="example-text-input"]').val();
              const format = $('input[name="name"]:checked').val();
              const packageId = "{{ dataset.get('id')}}";
              const fileInput = $('#fileInput')[0].files[0];  // Get the uploaded file
              const filename = fileInput.name;
              const url = filePath + filename;
              let normalizedUrl = url.replace(/\/+/g, '/');
              const resourceMetadata = {
                  "resource_metadata": {
                      "description": description,
                      "format": format,
                      "name": name,
                      "package_id": packageId,
                      "resource_tags": [],
                      "resource_type": "Tabular",
                      "url": "s3://" + normalizedUrl
                  }
              };

              $.ajax({
                  url: '/stelar/api/v1/resource/link',
                  method: 'POST',
                  contentType: 'application/json',
                  data: JSON.stringify(resourceMetadata),
                  success: function(response) {
                      $('#uploadStatus').html('<div class="alert alert-success">Resource Linked Succesfully!</div>');
                      $('#progress-bar-container').hide(); // Hide the progress bar after success
                      $('#uploadForm')[0].reset(); // Reset the form after successful upload
                      $('#progress-bar').width('0%'); // Reset progress bar
                      $('#progress-text').text('0%');
                      appendNewResourceRow(response.result);
                      setTimeout(function() {
                          $('#uploadStatus').fadeOut(500, function() {
                              $(this).remove();
                          });
                      }, 3000);
                  },
                  error: function(error) {
                      alert('Error linking resource!');
                  }
              });
            }
            function appendNewResourceRow(resource) {
              // Get the resource table body
              const resourceTableBody = $('table tbody');

              // Create a new table row with the resource data
              const newRow = `
                  <tr>
                      <td class="text-sm">${resource.name}</td>
                      <td class="text-sm"><small>${resource.url}</small></td>
                      <td class="text-sm">${resource.format}</td>
                      <td>
                          <button class="btn btn-sm view-resource-btn" data-bs-toggle="modal" data-bs-target="#modal-view-id" data-resource-id="${resource.id}">View ID</button>
                      </td>
                  </tr>
              `;

              // Append the new row to the table
              resourceTableBody.append(newRow);

              // Re-attach the event listener for the "View ID" button
              attachViewIdEventListeners();
            } 
      });
    

      </script>
      <script>
        // Fetch paths on page load
        $(document).ready(function() {
            fetchPaths();
        });
    
        // Fetch available paths
        // Fetch available paths
        function fetchPaths() {
            $.ajax({
                url: '/stelar/console/v1/publisher/fetch_paths',
                method: 'GET',
                success: function(data) {
                    var pathSelector = $('#pathSelector');
                    pathSelector.empty();  // Clear any existing options
                     // Add a placeholder as the default option
                    var placeholderOption = new Option('Select Destination Path Inside MinIO', '', true, true);
                    placeholderOption.disabled = true;  // Make it non-selectable
                    pathSelector.append(placeholderOption);
                    // Iterate over the zones and paths
                    $.each(data.paths, function(zone, directories) {
                        // Create an optgroup for each zone
                        var optGroup = $('<optgroup>', { label: zone });
                        // If there are no directories, add the root path (zone/)
                        if (directories.length === 0) {
                            var rootPath = zone + '/';
                            optGroup.append(new Option(rootPath, '/'));  // Add root path
                        }
                        // Add each subdirectory as an option within the optgroup
                        $.each(directories, function(index, directory) {
                            var fullPath = zone + '/' + directory;
                            optGroup.append(new Option(fullPath, directory));  // Both text and value are the full path
                        });
                        // Append the optgroup to the selector
                        pathSelector.append(optGroup);
                    });
                    // If no paths are available, show a message
                    if ($('#pathSelector option').length === 0) {
                        pathSelector.append(new Option('No available paths', ''));
                    }
                },
                error: function(error) {
                    console.log("Error fetching paths:", error);
                }
            });
        }
      </script>
  </body>
</html>
